import { cityName } from "./script.js";

const displayObjects = [
  {
    time: "day",
    weatherCode: 0,
    svg: `<svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 61.41 76.76249999999999"
          x="0px"
          y="0px"
          class="current-weather-icon"
        >
          
          <title>волныРесурс 43</title>
          <g data-name="Слой 2">
            <g data-name="Слой 1">
              <path
                d="M30.71,12.25A18.46,18.46,0,1,0,49.16,30.71,18.48,18.48,0,0,0,30.71,12.25Z"
              />
              <path
                d="M30.71,9.43a2,2,0,0,0,2-2V2a2,2,0,0,0-4,0V7.43A2,2,0,0,0,30.71,9.43Z"
              />
              <path
                d="M30.71,52a2,2,0,0,0-2,2v5.43a2,2,0,0,0,4,0V54A2,2,0,0,0,30.71,52Z"
              />
              <path
                d="M9.43,30.71a2,2,0,0,0-2-2H2a2,2,0,0,0,0,4H7.43A2,2,0,0,0,9.43,30.71Z"
              />
              <path d="M59.41,28.71H54a2,2,0,1,0,0,4h5.43a2,2,0,0,0,0-4Z" />
              <path
                d="M12.83,15.66a2,2,0,0,0,2.83-2.83L11.82,9A2,2,0,1,0,9,11.82Z"
              />
              <path
                d="M48.58,45.75a2,2,0,0,0-2.83,2.83l3.84,3.84a2,2,0,0,0,2.83-2.83Z"
              />
              <path
                d="M12.83,45.75,9,49.59a2,2,0,1,0,2.83,2.83l3.84-3.84a2,2,0,0,0-2.83-2.83Z"
              />
              <path
                d="M47.16,16.25a2,2,0,0,0,1.41-.59l3.84-3.84A2,2,0,1,0,49.59,9l-3.84,3.84a2,2,0,0,0,1.41,3.41Z"
              />
            </g>
          </g>
        </svg>`,
  },
  {
    time: "night",
    weatherCode: 7,
    svg: `<svg
          xmlns="http://www.w3.org/2000/svg"
          version="1.1"
          viewBox="-5.0 -10.0 110.0 135.0"
          class="current-weather-icon"
        >
          
          <path
            d="m27.555 40.426c1.0977-5.0859 4.0898-9.1758 8.5781-11.672 0.5-2.293 0.5-4.7891-0.30078-7.1836-0.69922-2.0938-1.8945-3.9883-3.293-5.4844 1.4961 8.8789-3.5898 17.754-12.367 20.648-3.2891 1.0977-6.8789 1.1953-10.172 0.39844 3.9883 4.0898 10.176 5.7852 15.961 3.9883 0.59766-0.19922 1.1953-0.49609 1.5938-0.69531zm56.758 17.953h-4.3906c-0.30078 0.10156-0.69922 0-0.99609-0.10156-0.69922-0.39844-0.89844-1.2969-0.59766-1.9961v-0.10156c0.59766-0.79688 0.69922-1.7969 0.69922-2.793 0-4.2891-4.3906-7.7812-9.875-7.7812h-2.5938c-0.79688 0-1.3984-0.69922-1.3984-1.4961 0-10.375-8.8789-15.16-17.457-15.16-3.293 0-6.3828 0.69922-9.1758 1.9961-0.10156 0.10156-0.10156 0.10156-0.19922 0.10156-4.6875 2.293-8.0781 6.4844-8.0781 13.066 0 1.5977 0.19922 3.293 0.59766 4.6875 0.10156 0.30078 0.10156 0.79688-0.10156 1.1953-0.19922 0.39844-0.69922 0.59766-1.1953 0.69922-4.1914 0.19922-7.4805 3.8906-7.4805 8.1797 0 4.5898 3.6914 8.2812 8.2812 8.2812h54.066c3.1875 0 5.582-1.9922 5.582-4.3867-0.10156-2.3945-2.6914-4.3906-5.6875-4.3906zm-45.484 13.867-5.6875 9.4766c-0.39844 0.69922-0.19922 1.5977 0.5 1.9961 0.19922 0.10156 0.5 0.19922 0.79688 0.19922 0.5 0 0.99609-0.30078 1.2969-0.69922l5.6875-9.4766c0.39844-0.69922 0.19922-1.5977-0.5-1.9961-0.69922-0.39844-1.5938-0.19922-2.0938 0.5zm12.469 0-5.6875 9.4766c-0.39844 0.69922-0.19922 1.5977 0.5 1.9961 0.19922 0.10156 0.5 0.19922 0.79688 0.19922 0.5 0 0.99609-0.30078 1.2969-0.69922l5.6875-9.4766c0.39844-0.69922 0.19922-1.5977-0.5-1.9961-0.69922-0.39844-1.5938-0.19922-2.0938 0.5zm12.469 0-5.7852 9.4766c-0.39844 0.69922-0.19922 1.5977 0.5 1.9961 0.19922 0.10156 0.5 0.19922 0.79688 0.19922 0.5 0 0.99609-0.30078 1.1953-0.69922l5.7852-9.4766c0.39844-0.69922 0.19922-1.5977-0.5-1.9961-0.69531-0.39844-1.5938-0.19922-1.9922 0.5zm12.469 0-5.6875 9.4766c-0.39844 0.69922-0.19922 1.5977 0.5 1.9961 0.19922 0.10156 0.5 0.19922 0.79688 0.19922 0.5 0 0.99609-0.30078 1.2969-0.69922l5.6875-9.4766c0.39844-0.69922 0.19922-1.5977-0.5-1.9961-0.79688-0.39844-1.6953-0.19922-2.0938 0.5z"
          />
        </svg>`,
  },
  {
    time: "night",
    weatherCode: 0,
    svg: `<svg
          xmlns:x="http://ns.adobe.com/Extensibility/1.0/"
          xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/"
          xmlns:graph="http://ns.adobe.com/Graphs/1.0/"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          version="1.1"
          x="0px"
          y="0px"
          class="current-weather-icon"
          viewBox="0 0 100 125"
          style="enable-background: new 0 0 100 100"
          xml:space="preserve"
        >
          <switch>
            <foreignObject
              requiredExtensions="http://ns.adobe.com/AdobeIllustrator/10.0/"
              x="0"
              y="0"
             
              width="1"
              height="1"
            />
            <g i:extraneous="self">
              <g>
                <path
                  d="M63.4,15.6c0.5,0.5,0.5,1.2,0.2,1.8l-2.4,4.4c-0.7,1.3,0.7,2.8,2,2.2l4.5-2.1c0.6-0.3,1.3-0.1,1.8,0.4l3.4,3.6     c1,1.1,2.9,0.2,2.7-1.3l-0.6-5c-0.1-0.7,0.3-1.3,0.9-1.6l4.5-2.1c1.4-0.7,1.1-2.7-0.4-3l-4.9-1c-0.7-0.1-1.2-0.7-1.3-1.3     l-0.6-4.9c-0.2-1.5-2.2-1.9-2.9-0.6l-2.4,4.3c-0.3,0.6-1,0.9-1.7,0.8l-4.9-0.9C60,9,59,10.8,60,11.9L63.4,15.6z"
                />
                <path
                  d="M55.1,47c0.5,0.3,0.7,0.8,0.6,1.3l-0.8,3.8c-0.3,1.2,1.1,2,2,1.2l2.9-2.5c0.4-0.3,1-0.4,1.4-0.1l3.3,2     c1,0.6,2.2-0.5,1.7-1.5l-1.5-3.6c-0.2-0.5-0.1-1,0.3-1.4l2.9-2.6c0.9-0.8,0.3-2.2-0.9-2.1l-3.9,0.3c-0.5,0-1-0.2-1.2-0.7     l-1.6-3.5c-0.5-1.1-2.1-0.9-2.3,0.2l-0.9,3.8c-0.1,0.5-0.6,0.9-1.1,0.9l-3.8,0.4c-1.2,0.1-1.5,1.7-0.5,2.3L55.1,47z"
                />
                <path
                  d="M96.9,56.6l-3.4-2.4c-0.5-0.3-0.7-0.9-0.5-1.5l1.1-4c0.4-1.2-1.1-2.2-2.1-1.4l-3.3,2.5c-0.5,0.3-1.1,0.4-1.5,0l-3.5-2.3     c-1.1-0.7-2.4,0.3-2,1.5l1.4,3.9c0.2,0.5,0,1.1-0.4,1.5l-3.3,2.6c-1,0.8-0.4,2.4,0.8,2.4l4.2-0.1c0.6,0,1.1,0.3,1.3,0.9l1.4,3.9     c0.4,1.2,2.1,1.1,2.5-0.1l1.2-4c0.2-0.5,0.7-0.9,1.2-0.9l4.2-0.2C97.5,59,98,57.4,96.9,56.6z"
                />
                <path
                  d="M76.4,75.5c-4.7,0.4-9.6,0-14.5-1.5c-19.8-6.2-30.9-27.2-24.8-47c1.5-4.8,3.9-9.1,6.9-12.8c1.7-2,0-4.9-2.6-4.7     C24.7,11.2,9.8,22.6,4.4,39.8c-7.1,22.8,5.7,47,28.5,54c17.1,5.3,35-0.6,45.9-13.5C80.5,78.4,79,75.3,76.4,75.5z"
                />
              </g>
            </g>
          </switch>
        </svg>`,
  },
  {
    time: "day",
    weatherCode: 2,
    svg: `<svg
          xmlns="http://www.w3.org/2000/svg"
          version="1.1"
          viewBox="-5.0 -10.0 110.0 135.0"
          class="current-weather-icon"
        >
          <path
            d="m39.668 52.648c1.625 0 3.2227 0.19922 4.7617 0.57812 0.59766 0.14844 1.1836 0.32031 1.7578 0.52344 1.0781-3.6875 3.1992-6.9258 6.0117-9.3828 1.3086-1.1445 2.7656-2.1133 4.3398-2.8867-1.0156-3.1289-2.9297-5.8594-5.4258-7.8906-2.9023-2.3594-6.6172-3.7773-10.668-3.7773-4.6719 0-8.8984 1.8945-11.957 4.9531-3.0586 3.0586-4.9531 7.2891-4.9531 11.961 0 2.3164 0.46094 4.5195 1.3008 6.5234 0.58594 1.4023 1.3516 2.7031 2.2695 3.8789 3.4258-2.7969 7.8008-4.4766 12.566-4.4766zm-36.047-3.6289c-1.2695 0-2.2969-1.0273-2.2969-2.2969 0-1.2695 1.0273-2.2969 2.2969-2.2969h6.9492c1.2695 0 2.2969 1.0273 2.2969 2.2969 0 1.2695-1.0273 2.2969-2.2969 2.2969zm9.1602-26.711c-0.89844-0.89844-0.89844-2.3477 0-3.25 0.89844-0.89844 2.3477-0.89844 3.25 0l4.9102 4.9102c0.89844 0.89844 0.89844 2.3516 0 3.25-0.89844 0.89844-2.3516 0.89844-3.25 0zm25.367-12.41c0-1.2695 1.0273-2.2969 2.2969-2.2969 1.2695 0 2.2969 1.0273 2.2969 2.2969v6.9492c0 1.2695-1.0273 2.2969-2.2969 2.2969-1.2695 0-2.2969-1.0273-2.2969-2.2969zm26.711 9.1602c0.89844-0.89844 2.3516-0.89844 3.25 0 0.89844 0.89844 0.89844 2.3516 0 3.25l-4.9102 4.9102c-0.89844 0.89844-2.3477 0.89844-3.25 0-0.89844-0.89844-0.89844-2.3477 0-3.25zm-4.0039 20.895c1.4141-0.32031 2.8906-0.49219 4.3984-0.49219 5.4883 0 10.457 2.2266 14.055 5.8242 3.4805 3.4805 5.6758 8.2461 5.8125 13.527 3.5234 0.72266 6.6484 2.5352 9.0078 5.0742 2.8164 3.0312 4.543 7.0898 4.543 11.543 0 4.6875-1.8984 8.9297-4.9727 12-3.0703 3.0703-7.3125 4.9727-12 4.9727h-42.035c-5.4883 0-10.457-2.2266-14.055-5.8242s-5.8242-8.5664-5.8242-14.055c0-4.5469 1.5273-8.7383 4.0977-12.086-1.3516-1.6289-2.4648-3.457-3.293-5.4336-1.0664-2.5547-1.6562-5.3516-1.6562-8.2812 0-5.9414 2.4102-11.316 6.3008-15.207s9.2656-6.3008 15.207-6.3008c5.1328 0 9.8516 1.8047 13.559 4.8164 3.1445 2.5547 5.5508 5.9844 6.8555 9.9219z"
            fill-rule="evenodd"
          />
        </svg>`,
  },
];

export async function renderPage(data) {
  const weatherCode = await data.current_weather.weathercode;
  const isDay = (await data.current_weather.is_day) ? "day" : "night";

  const windSpeed = await data.current_weather.windspeed;

  const currentTime = new Date(data.current_weather.time).toLocaleTimeString(
    "en-US",
    {
      hour: "2-digit",
      minute: "2-digit",
    }
  );
  renderdata();

  function renderdata() {
    let statsHtml = ``;

    let currentWeather = "";

    let bgVideoHtml = ``;

    displayObjects.forEach((weatherType) => {
      if (
        weatherCode === weatherType.weatherCode &&
        isDay === weatherType.time
      ) {
        currentWeather = weatherType;
      } else {
        if (weatherType.time === isDay) {
          currentWeather = weatherType;
        }
      }
    });

    const video = document.querySelector(".js-bg-loop");

    if (video) {
      const source = video.querySelector("source");

      // If <source> already exists, change its src
      if (source) {
        source.src =
          isDay === "day"
            ? "background-videos/sunny-sky.mp4"
            : "background-videos/Cloudy-night.mp4";
      } else {
        // If not, create a new source element
        const newSource = document.createElement("source");
        newSource.type = "video/mp4";
        newSource.src =
          isDay === "day"
            ? "background-videos/sunny-sky.mp4"
            : "background-videos/Cloudy-night.mp4";
        video.appendChild(newSource);
      }

      video.load(); // 🔄 This reloads and plays the new source
      video.play(); // Optional: ensures autoplay works in some cases
    } else {
      console.error("Video element not found!");
    }

    statsHtml = `
       ${currentWeather.svg}
        <span class="city-name">${cityName}</span>
        
        <div class="number-stats">
        <span class="time">${currentTime}</span>
          <span class="temps">${data.current_weather.temperature}&#xb0;C</span>
          <spaan class="wind">${windSpeed} km/h East</spaan>
        </div>
    
  `;

    document.querySelector(".js-weather-stats").innerHTML = statsHtml;
  }

  function renderBackgroungVideo(isDay) {
    let innerHtml;
    if (isDay === "day") {
      innerHtml = `<source src="background-videos/sunny-sky.mp4" type="video/mp4>`;
    } else {
      innerHtml = `<source src="background-videos/Cloudy-night.mp4" type="video/mp4 ">`;
    }

    document.querySelector(".js-bg-loop").innerHTML = innerHtml;
  }
}
